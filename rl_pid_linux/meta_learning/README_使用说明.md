# ğŸ“ Meta-PID + RL é¡¹ç›®ä½¿ç”¨è¯´æ˜

## ğŸ“š é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†åŸºäº**å…ƒå­¦ä¹ **å’Œ**è‡ªé€‚åº”å¼ºåŒ–å­¦ä¹ **çš„æœºå™¨äººPIDæ§åˆ¶ä¼˜åŒ–æ–¹æ³•ã€‚

**æ ¸å¿ƒåˆ›æ–°**ï¼š
1. ç‰©ç†å¢å¼ºæ•°æ®ç”Ÿæˆï¼ˆ300ä¸ªè™šæ‹Ÿæœºå™¨äººæ ·æœ¬ï¼‰
2. åˆ†å±‚æ§åˆ¶æ¶æ„ï¼ˆå…ƒå­¦ä¹  + RLï¼‰
3. æ··åˆä¼˜åŒ–ç­–ç•¥ï¼ˆå·®åˆ†è¿›åŒ– + å±€éƒ¨ç²¾ç‚¼ï¼‰
4. è‡ªé€‚åº”å½’ä¸€åŒ–å¥–åŠ±å‡½æ•°

**æ€§èƒ½**ï¼š
- å¹³å‡è¯¯å·®é™ä½ï¼š25.31%
- æœ€å¤§è¯¯å·®é™ä½ï¼š32.14%
- æ ‡å‡†å·®é™ä½ï¼š60.96%

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### **1. å¿«é€Ÿæµ‹è¯•ï¼ˆä½¿ç”¨ç°æœ‰æ¨¡å‹ï¼Œ2åˆ†é’Ÿï¼‰â­æ¨èæ–°æ‰‹**

```bash
./quick_test.sh
```

è¿™å°†ï¼š
- åŠ è½½é¢„è®­ç»ƒçš„å…ƒå­¦ä¹ æ¨¡å‹å’ŒRLç­–ç•¥
- è¯„ä¼°æ€§èƒ½å¹¶ç”Ÿæˆå¯¹æ¯”å›¾
- éªŒè¯å®é™…è·Ÿè¸ªè¯¯å·®

**è¾“å‡º**ï¼š
- æ€§èƒ½å¯¹æ¯”æ•°æ®ï¼ˆç»ˆç«¯æ˜¾ç¤ºï¼‰
- `actual_tracking_comparison.png`ï¼ˆå¯¹æ¯”å›¾ï¼‰

---

### **2. å®Œæ•´è®­ç»ƒæµç¨‹ï¼ˆä»å¤´è®­ç»ƒï¼Œçº¦10åˆ†é’Ÿï¼‰**

#### **æ­¥éª¤1ï¼šå‡†å¤‡æ•°æ®ï¼ˆçº¦45åˆ†é’Ÿï¼Œåªéœ€è¿è¡Œä¸€æ¬¡ï¼‰**
```bash
./prepare_data.sh
```

è¿™å°†ï¼š
- ç”Ÿæˆ300ä¸ªè™šæ‹Ÿæœºå™¨äººæ ·æœ¬
- ä¸ºæ¯ä¸ªæ ·æœ¬ä¼˜åŒ–çœŸå®æœ€ä¼˜PIDå‚æ•°

**æ³¨æ„**ï¼šæ­¤æ­¥éª¤è€—æ—¶è¾ƒé•¿ï¼Œä½†åªéœ€è¿è¡Œä¸€æ¬¡ã€‚å¦‚æœå·²æœ‰ `augmented_pid_data_optimized.json`ï¼Œå¯è·³è¿‡ã€‚

#### **æ­¥éª¤2ï¼šè®­ç»ƒå¹¶è¯„ä¼°ï¼ˆçº¦10åˆ†é’Ÿï¼‰**
```bash
./train_full_pipeline.sh
```

è¿™å°†ï¼š
- è®­ç»ƒå…ƒå­¦ä¹ PIDé¢„æµ‹å™¨ï¼ˆ2åˆ†é’Ÿï¼‰
- è®­ç»ƒè‡ªé€‚åº”RLç­–ç•¥ï¼ˆ3-5åˆ†é’Ÿï¼‰
- è¯„ä¼°æ€§èƒ½å¹¶ç”Ÿæˆå›¾è¡¨ï¼ˆ2åˆ†é’Ÿï¼‰

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
meta_learning/
â”œâ”€â”€ ğŸ“„ è®ºæ–‡ç»“æœæ€»ç»“.md           # è¯¦ç»†å®éªŒç»“æœå’Œè®ºæ–‡å†™ä½œè¦ç‚¹
â”œâ”€â”€ ğŸ“„ å…³é”®å‘½ä»¤æ¸…å•.md           # æ‰€æœ‰å‘½ä»¤çš„è¯¦ç»†è¯´æ˜
â”œâ”€â”€ ğŸ“„ README_ä½¿ç”¨è¯´æ˜.md        # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ”§ è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ prepare_data.sh          # æ•°æ®å‡†å¤‡ï¼ˆè¿è¡Œä¸€æ¬¡ï¼‰
â”‚   â”œâ”€â”€ train_full_pipeline.sh   # å®Œæ•´è®­ç»ƒæµç¨‹
â”‚   â””â”€â”€ quick_test.sh            # å¿«é€Ÿæµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ data_augmentation.py             # ç”Ÿæˆè™šæ‹Ÿæ ·æœ¬
â”‚   â”œâ”€â”€ optimize_all_virtual_samples.py  # ä¼˜åŒ–PIDå‚æ•°
â”‚   â”œâ”€â”€ train_with_augmentation.py       # è®­ç»ƒå…ƒå­¦ä¹ æ¨¡å‹
â”‚   â”œâ”€â”€ train_meta_rl_combined.py        # è®­ç»ƒRLç­–ç•¥
â”‚   â”œâ”€â”€ evaluate_meta_rl.py              # è¯„ä¼°æ€§èƒ½
â”‚   â””â”€â”€ verify_actual_tracking_error.py  # éªŒè¯å®é™…è¯¯å·®
â”‚
â”œâ”€â”€ ğŸ“Š æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ augmented_pid_data.json          # è™šæ‹Ÿæ ·æœ¬ï¼ˆå¯å‘å¼PIDï¼‰
â”‚   â”œâ”€â”€ augmented_pid_data_optimized.json # è™šæ‹Ÿæ ·æœ¬ï¼ˆä¼˜åŒ–PIDï¼‰
â”‚   â””â”€â”€ meta_pid_augmented.pth           # å…ƒå­¦ä¹ æ¨¡å‹
â”‚
â””â”€â”€ ğŸ“ æ¨¡å‹è¾“å‡º
    â””â”€â”€ logs/meta_rl_panda/
        â”œâ”€â”€ best_model/best_model.zip    # æœ€ä½³RLæ¨¡å‹
        â””â”€â”€ evaluations.npz              # è®­ç»ƒè®°å½•
```

---

## ğŸ¯ å¸¸ç”¨å‘½ä»¤

### **è®­ç»ƒç‰¹å®šæœºå™¨äºº**

#### **Franka Pandaï¼ˆé»˜è®¤ï¼‰**
```bash
cd /home/wujiahao/åŸºäºå¼ºåŒ–å­¦ä¹ çš„æ¨¡å‹é¢„æµ‹æ§åˆ¶åŠ¨åŠ›å­¦æ¨¡å‹è¯¯å·®åœ¨çº¿è¡¥å¿æ–¹æ³•ç ”ç©¶/rl_pid_linux/meta_learning
source ~/rl_robot_env/bin/activate
python train_meta_rl_combined.py franka_panda/panda.urdf 200000 4
```

#### **Laikagoå››è¶³æœºå™¨äºº**
```bash
python train_meta_rl_combined.py laikago/laikago.urdf 200000 4
```

#### **KUKAæœºæ¢°è‡‚**
```bash
python train_meta_rl_combined.py kuka_iiwa/model.urdf 200000 4
```

**å‚æ•°è¯´æ˜**ï¼š
- ç¬¬1ä¸ªå‚æ•°ï¼šæœºå™¨äººURDFè·¯å¾„
- ç¬¬2ä¸ªå‚æ•°ï¼šè®­ç»ƒæ­¥æ•°ï¼ˆæ¨è200000ï¼Œçº¦3-5åˆ†é’Ÿï¼‰
- ç¬¬3ä¸ªå‚æ•°ï¼šå¹¶è¡Œç¯å¢ƒæ•°ï¼ˆ1-8ï¼Œæ¨è4ï¼‰

---

### **è¯„ä¼°æ€§èƒ½**

#### **å½’ä¸€åŒ–è¯¯å·®è¯„ä¼°ï¼ˆå¿«é€Ÿï¼‰**
```bash
python evaluate_meta_rl.py
```

#### **å®é™…è·Ÿè¸ªè¯¯å·®éªŒè¯ï¼ˆè¯¦ç»†ï¼‰**
```bash
python verify_actual_tracking_error.py
```

---

### **å¯è§†åŒ–åˆ†æ**

#### **æŸ¥çœ‹è®­ç»ƒæ›²çº¿**
```bash
python -c "
import numpy as np
import matplotlib.pyplot as plt

data = np.load('logs/meta_rl_panda/evaluations.npz')
plt.plot(data['timesteps'], data['results'])
plt.xlabel('Training Steps')
plt.ylabel('Mean Reward')
plt.title('RL Training Progress')
plt.grid(True)
plt.savefig('training_curve.png', dpi=150)
print('âœ… è®­ç»ƒæ›²çº¿å·²ä¿å­˜: training_curve.png')
"
```

#### **æŸ¥çœ‹ç”Ÿæˆçš„å¯¹æ¯”å›¾**
```bash
xdg-open actual_tracking_comparison.png
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### **å…ƒå­¦ä¹ PIDé¢„æµ‹æ€§èƒ½**
- å¹³å‡é¢„æµ‹è¯¯å·®ï¼š3.33Â°
- å¯¹æ¯”å¯å‘å¼æ–¹æ³•æ”¹å–„ï¼š91.10%

### **Meta-PID + RLæ•´ä½“æ€§èƒ½**
| æŒ‡æ ‡ | çº¯Meta-PID | Meta-PID+RL | æ”¹å–„ |
|------|-----------|-------------|------|
| å¹³å‡è¯¯å·® | 46.76Â° | 34.93Â° | **+25.31%** |
| æœ€å¤§è¯¯å·® | 101.47Â° | 68.85Â° | **+32.14%** |
| æ ‡å‡†å·® | 19.95Â° | 7.79Â° | **+60.96%** |

### **å„å…³èŠ‚æ€§èƒ½ï¼ˆFranka Pandaï¼‰**
- å…³èŠ‚2æ”¹å–„æœ€æ˜¾è‘—ï¼š**67.45%**ï¼ˆ30.56Â° â†’ 9.95Â°ï¼‰
- æ•´ä½“è¯¯å·®ä»46.76Â°é™è‡³34.93Â°

---

## ğŸ” å¸¸è§é—®é¢˜

### **Q1: è®­ç»ƒæ—¶å‡ºç° EOFError æˆ– BrokenPipeError**
**A**: PyBulletå¤šè¿›ç¨‹é—®é¢˜ï¼Œå‡å°‘å¹¶è¡Œç¯å¢ƒæ•°ï¼š
```bash
python train_meta_rl_combined.py franka_panda/panda.urdf 200000 1
```

### **Q2: GPUå†…å­˜ä¸è¶³**
**A**: å‡å°‘å¹¶è¡Œç¯å¢ƒæ•°æˆ–ä½¿ç”¨CPUï¼š
```bash
python train_meta_rl_combined.py franka_panda/panda.urdf 200000 2
```

### **Q3: è®­ç»ƒä¸æ”¶æ•›æˆ–å‘æ•£**
**A**: æ£€æŸ¥å¥–åŠ±å‡½æ•°æ˜¯å¦å½’ä¸€åŒ–ï¼Œç¡®ä¿åŒ…å«ï¼š
```python
tracking_error_norm = np.linalg.norm(error) / np.sqrt(n_dof)
reward = np.clip(reward, -100.0, 10.0)
```

### **Q4: 50ä¸‡æ­¥æ•ˆæœåè€Œå˜å·®**
**A**: è¿‡æ‹Ÿåˆç°è±¡ï¼Œä½¿ç”¨20ä¸‡æ­¥æ˜¯æœ€ä¼˜é€‰æ‹©ï¼š
```bash
python train_meta_rl_combined.py franka_panda/panda.urdf 200000 4
```

### **Q5: å¦‚ä½•æŸ¥çœ‹è®­ç»ƒè¿›åº¦**
**A**: å®æ—¶ç›‘æ§æ—¥å¿—ï¼š
```bash
# å¦‚æœä½¿ç”¨åå°è®­ç»ƒï¼ˆnohupï¼‰
tail -f meta_rl_training.log

# æå–å…³é”®æŒ‡æ ‡
grep -E "ep_reward_mean|value_loss" meta_rl_training.log | tail -20
```

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- **å®Œæ•´å®éªŒç»“æœ**ï¼š`è®ºæ–‡ç»“æœæ€»ç»“.md`
- **å‘½ä»¤å‚è€ƒ**ï¼š`å…³é”®å‘½ä»¤æ¸…å•.md`
- **è®ºæ–‡å†™ä½œè¦ç‚¹**ï¼š`è®ºæ–‡ç»“æœæ€»ç»“.md` ç¬¬10èŠ‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ `å…³é”®å‘½ä»¤æ¸…å•.md` ç¬¬7èŠ‚ï¼ˆå¸¸è§é—®é¢˜æ’æŸ¥ï¼‰
2. æ£€æŸ¥ `è®ºæ–‡ç»“æœæ€»ç»“.md` ä¸­çš„å®éªŒè®¾ç½®
3. ç¡®è®¤ç¯å¢ƒé…ç½®æ­£ç¡®ï¼ˆPyBullet, PyTorch, SB3ï¼‰

---

## ğŸ“ å¼•ç”¨

å¦‚æœæœ¬é¡¹ç›®å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@article{meta_pid_rl_2025,
  title={åŸºäºå…ƒå­¦ä¹ å’Œè‡ªé€‚åº”å¼ºåŒ–å­¦ä¹ çš„æœºå™¨äººPIDæ§åˆ¶ä¼˜åŒ–},
  author={...},
  journal={...},
  year={2025}
}
```

---

**ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ29æ—¥  
**è”ç³»æ–¹å¼**: [è¯·æ ¹æ®å®é™…æƒ…å†µå¡«å†™]

